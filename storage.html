<!DOCTYPE html>
<html>
  <head>
    <title>Scott Fryxell</title>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <link rel="stylesheet" href="/application.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="canonical"  href="https://scott-fryxell.github.io/">

    
    <script src="https://unpkg.com/vue"></script>
    <script src="https://www.gstatic.com/firebasejs/4.3.1/firebase.js"></script>
  </head>
  <body class='developer'>
    <header>
      <a href="/"><svg id="logo"><use xlink:href="/application.svg#logo"/></svg></a>
      <nav>
        <a href="/resume">CV</a>
        <a href="https://cash.me/$ScottFryxell">$</a>
      </nav>
    </header>
    <main>
      <section id="posts" itemscope itemtype="http://schema.org/blog">
   <aside>
    <h1>loading...</h1>
  </aside>
  <header>
    <posts-form>
  </posts-form></header>
  <posts-lists>
 </posts-lists></section>

<script id="initialize-firebase">
  // Initialize Firebase
  let config = {
    apiKey: "AIzaSyDpRbQe67nfP2HTxkThxhY2Fk-ru0x2aus",
    authDomain: "littleman-8f289.firebaseapp.com",
    databaseURL: "https://littleman-8f289.firebaseio.com",
    storageBucket: "littleman-8f289.appspot.com",
    messagingSenderId: "363642054727"
  }
  firebase.initializeApp(config)
  const storage_ref = firebase.storage().ref()
  const auth = firebase.auth()
</script>

<script id="initialize-user">
  auth.onAuthStateChanged( user => {
    if (user) {
      // User is signed in.
      const url = `users/${auth.currentUser.uid}/posts.html`
      // load_posts(url)
      // save_posts(url)
    } else {
      // User is signed out.
      auth.signInAnonymously()
    }
  })
</script>

<script id="save-posts">
  function save_posts(url) {
    const file_parts  = [document.getElementById('posts').outerHTML]
    const user_posts  = new File(file_parts, 'posts.html')
    const metadata    = {'contentType': 'text/html'}
    storage_ref.child( url ).put( user_posts, metadata ).then( snapshot => {
      console.log('Uploaded', snapshot.totalBytes, 'bytes.')
      console.log(snapshot.metadata)
      console.log(snapshot.fullPath)
      console.log('File available at', snapshot.downloadURL)
    }).catch(console.log.bind(console))
  }
</script>

<script id="load-posts">
  function load_posts(url) {
    storage_ref.child(url).getDownloadURL()
    .then( url => fetch(url))
    .then( response => response.text() )
    .then( text => document.getElementById('posts').outerHTML = text )
    .catch( console.log.bind(console) )
  }
</script>

<script id="app">
  var app = new Vue({
    el:   'section#posts',
    data: document.getItems("http://schema.org/SocialMediaPosting")
  })
</script>

<template id="post-form">
  <form action="index.html" method="post">
    <textarea name="name" placeholder="Wat?"></textarea>
    <input type="submit">
  </form>
</template>

<template id="post">
  <article itemscope itemid="{{me.id}}/posts/{{guid}}" itemtype="http://schema.org/SocialMediaPosting">
    <header>
      <time itemprop="created_at" datetime="{{post.created_at}}">Just Now</time>
    </header>
    <p itemprop="articleBody">{{post.body}}</p>
  </article>
</template>

<template id="assertions">
  As a user
    I can update my profle with a new post
</template>
    </main>
    <footer>
      <details class="style">
        <summary>
          <svg id="style"><use xlink:href="/application.svg#leaf"/></svg>
          <h5>Style</h5>
        </summary>
        <style media="screen">
          * remove {
            outline: 1px solid hsla(203, 58%, 57%, 0.9);
          }
        </style>
      </details>
      <details class="script">
        <summary>
          <svg id="script"><use xlink:href="/application.svg#leaf"/></svg>
          <h5>Script</h5>
        </summary>
        <script type="text/javascript" >
          document.body.addEventListener('keydown', function(keydown) {
            var enter = 13;
            if(keydown.keyCode == enter && keydown.metaKey) {
              var content = document.querySelector("body")
              if( content.isContentEditable ) {
                content.removeAttribute("contenteditable");
              } else {
                content.setAttribute("contenteditable",  true);
              }
            }
          });
        </script>
      </details>
    </footer>
  </body>

</html>
